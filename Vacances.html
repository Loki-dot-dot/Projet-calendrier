<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Vacances</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <style>
    html {
      height: 100%;
    }

    body {
      min-height: 100%;
      display: flex;
      flex-direction: column;
      background-image: url('images/pexels-pixabay-207580.jpg');
      background-size: cover;
      background-attachment: fixed;
      background-repeat: no-repeat;
      background-position: center;
    }

    footer {
      margin-top: auto;
    }

    #table {
      margin: 50px auto;
      border-collapse: separate;
      width: 80%;
      background-color: rgba(255, 255, 255, 0.9);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      padding: 10px;
      border-radius: 10px;
    }

    .bg-past {
      background-color: lightgray !important;
    }

    .bg-today-ongoing {
      background-color: lightgreen !important;
    }

    .bg-upcoming {
      background-color: orange !important;
    }

    .bg-past td {
      background-color: lightgray !important;
      color: grey !important;
    }

    .bg-today-ongoing td {
      background-color: lightgreen !important;
      color: darkgreen !important;
    }

    .bg-upcoming td {
      background-color: orange !important;
      color: rgb(190, 92, 0) !important;
    }

  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg bg-secondary position-sticky z-3 top-0">
    <div class="container-fluid">
      <div class="navbar-brand text-light">
        <img src="images/Capture d'écran 2025-09-24 101405.png" alt="Logo" style="width:40px;" class="rounded-pill text-secondary me-2">
        Calendrier OFPPT
      </div>
      <ul class="navbar-nav">
        <li class="nav-item"><a href="index.html"><button class="btn btn-secondary">Accueil</button></a></li>
        <li class="nav-item"><a href="emplois.html"><button class="btn btn-secondary">Emplois</button></a></li>
        <li class="nav-item"><a href="Vacances.html"><button class="btn btn-secondary">Vacances</button></a></li>
        <li class="nav-item"><a href="liste_efm(f).html"><button class="btn btn-secondary">EFM/EFF</button></a></li>
        <div class="dropdown">
          <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">Choisir un groupe</button>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="#">DEV201</a></li>
            <li><a class="dropdown-item" href="#">DEV202</a></li>
            <li><a class="dropdown-item" href="#">DEV203</a></li>
          </ul>
        </div>
      </ul>
    </div>
  </nav>

  <table border="black" cellspacing="0" id="table" class="table table-bordered">
    <thead>
      <tr>
        <th>Événement</th>
        <th>Nombre de Jours</th>
        <th>Date de vacances</th>
      </tr>
    </thead>
    <tbody id="events-body">
      <tr>
        <td colspan="3">Chargement des événements...</td>
      </tr>
    </tbody>
  </table>

  <footer class="container-fluid bg-secondary text-light text-center p-3">
    © 2025-2026 Calendrier OFPPT - Tous droits réservés.
    <a class="nav-link text-light" href="#">À propos</a>
  </footer>

  <script>
    function normalizeDate(d) {
      return new Date(d.getFullYear(), d.getMonth(), d.getDate());
    }

    function getStartDate(event) {
      if (typeof event.date === 'string') return new Date(event.date);
      if (event.date.debut) return new Date(event.date.debut);
      return null;
    }

    function getEndDate(event) {
      if (typeof event.date === 'string') return new Date(event.date);
      if (event.date.fin) return new Date(event.date.fin);
      return null;
    }

    function getEventStatusClasses(events) {
      const today = normalizeDate(new Date());

      const futureEvents = events
        .map((event, idx) => ({ event, idx, startDate: getStartDate(event) }))
        .filter(({ startDate }) => startDate && normalizeDate(startDate) > today);

      futureEvents.sort((a, b) => a.startDate - b.startDate);

      const closestUpcomingIdx = futureEvents.length ? futureEvents[0].idx : null;

      return events.map((event, idx) => {
        let startDate = getStartDate(event);
        let endDate = getEndDate(event);

        if (startDate) startDate = normalizeDate(startDate);
        if (endDate) endDate = normalizeDate(endDate);

        if (endDate && endDate < today) return 'bg-past';
        if (!endDate && startDate && startDate < today) return 'bg-past';

        if (startDate && startDate.getTime() === today.getTime()) return 'bg-today-ongoing';
        if (endDate && startDate && today >= startDate && today <= endDate) return 'bg-today-ongoing';

        if (startDate) {
          const diffDays = (startDate - today) / (1000 * 60 * 60 * 24);
          if (idx === closestUpcomingIdx && diffDays > 0 && diffDays <= 14) {
            return 'bg-upcoming';
          }
        }

        return '';
      });
    }

    async function loadAndRenderEvents() {
      const tbody = document.getElementById('events-body');

      try {
        const response = await fetch('Dates.json');
        if (!response.ok) throw new Error('Échec du chargement de Dates.json');

        const events = await response.json();
        const classes = getEventStatusClasses(events);

        tbody.innerHTML = '';

        events.forEach((event, i) => {
          const tr = document.createElement('tr');
          if (classes[i]) tr.classList.add(classes[i]);

          const tdEvent = document.createElement('td');
          tdEvent.textContent = event.evenement;

          const tdDays = document.createElement('td');
          tdDays.textContent = event.jours;

          const tdDate = document.createElement('td');
          if (typeof event.date === 'string') {
            tdDate.textContent = event.date;
          } else {
            tdDate.textContent = `Du ${event.date.debut} au ${event.date.fin}`;
          }

          tr.appendChild(tdEvent);
          tr.appendChild(tdDays);
          tr.appendChild(tdDate);

          tbody.appendChild(tr);
        });

      } catch (error) {
        tbody.innerHTML = `<tr><td colspan="3">${error.message}</td></tr>`;
        console.error(error);
      }
    }

    document.addEventListener('DOMContentLoaded', loadAndRenderEvents);
  </script>
</body>
</html>
